<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IiU pesäpallo</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
        margin: 0;
        padding: 0;
    }

    #live-match-widget {
        width: 320px;
        margin: 20px auto;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        position: fixed;
        top: 20px;
        left: 20px;
        font-size: 16px;
    }

    #live-match-widget-subheader {
        background-color: #0d47a1;
        color: #fff;
        padding: 15px;
        text-align: center;
        font-weight: bold;
        font-size: 1.4em;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    #live-match-widget-subheader img {
        height: 30px;
        width: auto;
    }

    #live-match-widget-content {
        padding: 15px 20px;
    }

    #live-match-widget p {
        margin: 5px 0;
        padding: 5px 0;
        text-align: left;
    }

    #live-match-widget p.bold {
        font-weight: bold;
    }

    #live-match-widget p:not(.bold) {
        color: #666;
    }

    .result {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .result span {
        flex: 1;
    }

    .team {
        font-weight: bold;
    }

    .score {
        text-align: center;
        font-weight: bold;
    }

    .black-text {
        color: black;
    }

    hr {
        border: 0;
        border-top: 1px solid #ddd;
        margin: 10px 0;
    }
</style>
</head>
<body>
<div id="live-match-widget">
    <div id="live-match-widget-subheader">
        <!-- Subheader content will be inserted here by JavaScript -->
    </div>
    <div id="live-match-widget-content">
        <!-- Content will be inserted here by JavaScript -->
    </div>
</div>

<script>
    async function fetchMatchResult() {
        const response = await fetch('https://www.pesistulokset.fi/api/v1/public/match-live-result?id=86020&apikey=3s0Uuz7ihVQYnOOQ4ROve8SJaCsX91nj');
        const data = await response.json();
        const result = data.result;

        // Mocking the result data
        // const result = {
        //     "periods": {
        //         "home": 0,
        //         "away": 0
        //     },
        //     "runs": [
        //         {
        //             "home": [0, null, null, null],
        //             "away": [0, null, null, null]
        //         },
        //         {
        //             "home": [null, null, null, null],
        //             "away": [null, null, null, null]
        //         },
        //         {
        //             "home": [null, null, null, null],
        //             "away": [null, null, null, null]
        //         },
        //         {
        //             "home": [null, null, null, null],
        //             "away": [null, null, null, null]
        //         }
        //     ],
        //     "finished": false
        // };

        displayResults(result);
    }

    function displayResults(result) {
        const { periods, runs, finished } = result;
        const homeTeam = "HP-K";
        const awayTeam = "Ii";

        const getInningResult = (inning) => {
            const homeEmpty = inning.home.every(run => run === null);
            const awayEmpty = inning.away.every(run => run === null);
            
            if (homeEmpty && awayEmpty) {
                return 'ei alkanut';
            }

            const homeRuns = inning.home.reduce((acc, val) => acc + (val || 0), 0);
            const awayRuns = inning.away.reduce((acc, val) => acc + (val || 0), 0);

            return `${homeRuns}-${awayRuns}`;
        };

        const inning1Result = getInningResult(runs[0]);
        const inning2Result = getInningResult(runs[1]);
        const inning3Result = runs[2].home.some(run => run !== null) || runs[2].away.some(run => run !== null) ? getInningResult(runs[2]) : '';
        const inning4Result = runs[3].home.some(run => run !== null) || runs[3].away.some(run => run !== null) ? getInningResult(runs[3]) : '';

        const subheaderContent = `
            <img src="https://github.com/nalkamaa/iiu/blob/main/HPK.png?raw=true" alt="H-PK logo">
            <span class="team">${homeTeam.toUpperCase()} ${periods.home}</span> - <span class="team">${periods.away} ${awayTeam.toUpperCase()}</span>
            <img src="https://github.com/nalkamaa/iiu/blob/main/Ii.png?raw=true" alt="Ii logo">
        `;

        const mainContent = `
            <p class="black-text ${inning1Result !== 'ei alkanut' ? 'bold' : ''} result"><span>1. jakso</span> <span class="score">${inning1Result}</span></p>
            <hr>
            <p class="${inning2Result !== 'ei alkanut' ? 'bold' : ''} result"><span>2. jakso</span> <span class="score">${inning2Result}</span></p>
            ${inning3Result ? `<hr><p class="bold result"><span>Supervuoro</span> <span class="score">${inning3Result}</span></p>` : ''}
            ${inning4Result ? `<hr><p class="bold result"><span>Kotiutuslyöntikisa</span> <span class="score">${inning4Result}</span></p>` : ''}
        `;

        document.getElementById('live-match-widget-subheader').innerHTML = subheaderContent;
        document.getElementById('live-match-widget-content').innerHTML = mainContent;
    }

    fetchMatchResult();
    setInterval(fetchMatchResult, 45000);
</script>
</body>
</html>
